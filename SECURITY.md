# Руководство по безопасности проекта

## Исправленные уязвимости

### Критическая уязвимость: Повышение привилегий пользователя (26.08.2023)

**Описание:** Обнаружена критическая уязвимость, позволяющая обычному пользователю получить права администратора путем изменения поля `role` в своем профиле.

**Сценарий атаки:**

1. Пользователь регистрировался в системе с обычной учетной записью
2. На странице редактирования профиля ему отображались данные администратора
3. После обновления страницы пользователь получал административные привилегии
4. Пользователь получал доступ к административной панели

**Исправление:**

- Добавлена защита от изменения роли в API `/api/users/profile`
- Добавлена проверка роли пользователя на клиенте при каждом обновлении данных
- Добавлены проверки в middleware авторизации
- Улучшена проверка ролей в административных маршрутах
- Добавлены дополнительные проверки при сохранении данных в localStorage
- Создан компонент `SecurityProvider` для системного контроля безопасности приложения

### Уязвимость в localStorage: Сохранение недействительных данных профиля (28.08.2023)

**Описание:** Обнаружена уязвимость, связанная с сохранением профиля администратора в localStorage, что приводило к отображению данных администратора обычным пользователям при редактировании профиля.

**Сценарий атаки:**

1. Приложение сохраняло профиль в localStorage для обеспечения работы офлайн
2. При смене пользователя или роли данные в localStorage не очищались корректно
3. Обычный пользователь получал доступ к просмотру информации об администраторе
4. Возникала возможность повысить свои привилегии при перезагрузке страницы

**Исправление:**

- Добавлена очистка всех сохраненных профилей при выходе из системы
- Создан механизм проверки соответствия ролей в сохраненных данных
- Реализована автоматическая синхронизация данных между хранилищами
- Добавлена проверка изменений localStorage для обеспечения многопользовательской безопасности
- Реализована система аудита действий пользователя для обнаружения подозрительной активности

## Текущие меры безопасности

### Аутентификация и авторизация

- Хеширование паролей с использованием bcrypt
- JWT токены для аутентификации с ограниченным сроком действия (7 дней)
- Проверка прав доступа на основе ролей
- Защищенные маршруты для администраторов
- Дополнительная проверка ролей в базе данных при доступе к административным функциям

### Защита API

- Валидация входных данных на сервере
- Защита от несанкционированного изменения ролей пользователей
- Логирование подозрительных действий
- Проверка JWT токенов на валидность и срок действия

### Безопасность на клиенте

- Проверка ролей при каждом обновлении данных пользователя
- Предотвращение несанкционированного изменения ролей в localStorage
- Автоматический выход при истечении срока действия токена
- Редиректы на страницу "Доступ запрещен" при попытке доступа к защищенным ресурсам
- Компонент безопасности `SecurityProvider` для системной проверки и защиты данных
- Аудит действий пользователя с целью обнаружения попыток нарушения безопасности
- Синхронизация данных между вкладками браузера и проверка при возвращении на страницу

### Архитектурные улучшения безопасности

- Создана система утилит безопасности в модуле `securityUtils.ts`
- Разделение обязанностей: проверка данных, аудит, очистка данных
- Проверка согласованности данных между различными хранилищами
- Предотвращение атак через манипуляции с localStorage в других вкладках
- Контроль целостности данных пользователя между запросами
- Двойная проверка роли на сервере и клиенте

## Рекомендации по безопасности

1. **Регулярные аудиты кода:** Проводить регулярные аудиты кода для выявления уязвимостей

2. **Обновление зависимостей:** Регулярно обновлять зависимости проекта для устранения известных уязвимостей

3. **Мониторинг подозрительной активности:** Использовать данные аудита для выявления подозрительной активности

4. **Двухфакторная аутентификация:** Реализовать двухфакторную аутентификацию для повышения безопасности

5. **HTTPS:** Обеспечить работу приложения только через HTTPS

6. **Дополнительная защита административных разделов:** Рассмотреть возможность добавления второго фактора для доступа к административным функциям

## Процедура обновления в случае обнаружения уязвимостей

1. Документировать уязвимость и способы её эксплуатации
2. Разработать исправление и протестировать его
3. Внедрить исправление в среду разработки
4. Развернуть исправление на продакшен
5. Обновить документацию по безопасности
6. Уведомить пользователей о необходимости обновления (если применимо)

## Контактная информация для сообщений о безопасности

Если вы обнаружили уязвимость, пожалуйста, сообщите об этом по адресу:

- Email: security@example.com
